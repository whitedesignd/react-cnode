{"version":3,"sources":["View/Details.js","Components/personal/Personal.jsx","Components/topic/TopicTab.js"],"names":["connect","state","token","props","match","useState","data","setData","reply","setReply","isCollect","setCollect","useContext","Context","timeInterval","now","editorState","setEditor","prew","useRef","useEffect","a","axios","get","params","id","accesstoken","then","res","replies","is_collect","getDetails","BraftEditor","createEditorState","handClick","useCallback","e","currentTarget","scrollIntoView","behavior","likeClcik","preventDefault","alert","index","findIndex","v","ups","includes","splice","indexOf","push","extendControls","key","type","text","onClick","className","top","good","tab","title","create_at","to","author","loginname","visit_count","last_reply_at","post","success","dangerouslySetInnerHTML","__html","content","reply_count","map","i","src","avatar_url","alt","bind","length","style","value","controls","onChange","toHTML","ref","console","log","rp","Math","round","Array","Date","height","width","Personal","useSelector","personal","background","href","TopicTab","green","backgroundColor","color","styleGood","fontSize","padding","whiteSpace","lineHeight","margin","borderRadius"],"mappings":"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","file":"static/js/8.eef31a5f.chunk.js","sourcesContent":["import React, { useState, useEffect, useContext, useCallback,useRef } from 'react';\r\nimport TopicTab from '../Components/topic/TopicTab'\r\nimport { NavLink } from 'react-router-dom';\r\nimport Context from '../Context.js'\r\nimport { connect } from 'react-redux';\r\nimport BraftEditor from 'braft-editor'\r\nimport 'braft-editor/dist/index.css'\r\nimport axios from 'axios'\r\nimport Personal from '../Components/personal/Personal.jsx'\r\nfunction Details(props) {\r\n    const { match } = props;\r\n    const [data, setData] = useState();\r\n    const [reply, setReply] = useState([]);\r\n    const [isCollect,setCollect] = useState();\r\n\r\n    // 计算时间间隔\r\n    const {now, timeInterval } = useContext(Context);\r\n    // 富文本\r\n    const [editorState, setEditor] = useState();\r\n\r\n    // prew ref\r\n    const prew = useRef();\r\n\r\n    useEffect(() => {\r\n        const getDetails = async () => {\r\n            let { data: res } = await axios.get('/v1/topic/' + match.params.id,{params:{accesstoken: props.token}}).then(res=>res.data);\r\n            setData(res);\r\n            setReply(res.replies);\r\n            setCollect(res.is_collect);\r\n        };\r\n        getDetails();\r\n        setEditor(BraftEditor.createEditorState(''))\r\n    }, []);\r\n    // 评论滚动到可视区顶部\r\n    const handClick = useCallback((e) => {\r\n        e.currentTarget.scrollIntoView({ behavior: \"smooth\" })\r\n        return false;\r\n    }, []);\r\n\r\n    //点赞\r\n    const likeClcik = useCallback((id, e) => {\r\n        e.preventDefault();\r\n        if(!props.token) return alert(\"请登录\");\r\n        let index = reply.findIndex(v => {\r\n            return v.id == id;\r\n        });\r\n        reply[index].ups.includes(props.token) ? reply[index].ups.splice(reply[index].ups.indexOf(props.token), 1) : reply[index].ups.push(props.token);\r\n        setReply([...reply]);\r\n    },[]);\r\n    // 单独的回复\r\n    const replyContent = () =>{\r\n\r\n    }\r\n\r\n    // 富文本编辑器\r\n    const handleEditorChange = (editorState) => {\r\n        setEditor(editorState.toHTML())\r\n    };\r\n    //预览\r\n    const preview = () => {\r\n    }\r\n    // 回复\r\n    const handleReplay = (e) =>{\r\n        e.preventDefault();\r\n        console.log(reply[1]);\r\n        const rp = {\r\n            id: \"5ee1f524b703280f0bcb9240\"+ Math.round(0.5), \r\n            author: {\r\n                avatar_url: \"https://avatars2.githubusercontent.com/u/14976489?v=4&s=120\",\r\n                loginname: \"zy445566\"\r\n            },\r\n            content: editorState,\r\n            ups: Array(0), \r\n            create_at: new Date(), \r\n        }\r\n        reply.push(rp);\r\n        setReply([...reply]);\r\n        setEditor('')\r\n    }\r\n    // BraftEditor配置项\r\n    const controls = [\r\n        'bold', 'italic', 'underline', 'separator',\r\n        'media',\r\n        'letter-spacing',\r\n        'strikethrough',\r\n        'line-height',\r\n        'clear',\r\n        'subscript',\r\n        'hr',\r\n        'text-align',\r\n        'emojis', \r\n    ];\r\n     // BraftEditor配置项\r\n    const extendControls = [\r\n        {\r\n            key: 'custom-button',\r\n            type: 'button',\r\n            text: '预览',\r\n            onClick: preview\r\n        }\r\n    ];\r\n\r\n    // 添加取消收藏\r\n    const handCollection = (e) =>{\r\n        e.preventDefault();\r\n        axios.post(`/v1/topic_collect/${isCollect?'de_collect':'collect'}`,{'accesstoken':props.token,'topic_id':data.id })\r\n            .then( res => {\r\n                if(res.success) setCollect(!isCollect);\r\n            })\r\n    }\r\n    return (\r\n        <>\r\n            {!data ? <div className='header-router' style={{ 'backgroundColor': '#fff',height:'800px',width:'73%'}}></div> : <div className='header-router'>\r\n                    <div className='details-content router-content'>\r\n                        <div className=\"header topic_header\">\r\n                            <TopicTab top={data?.top} good={data?.good} tab={data?.tab}></TopicTab>\r\n                            <div className=\"topic_htitle\">\r\n                                {data?.title}\r\n                            </div>\r\n                            <div className=\"changes\">\r\n                                <span >发布于 {timeInterval(data?.create_at)}</span>\r\n                                <span >作者  <NavLink to={'/user/' + data?.author.loginname}>{data?.author.loginname}</NavLink>\r\n                                </span>\r\n                                <span >{data?.visit_count} 次浏览</span>\r\n                                <span >最后一次编辑是 {timeInterval(data?.last_reply_at)}</span>\r\n                                <span >来自 {data?.tab == 'ask' ? '问答' : '分享'}</span>\r\n                                {\r\n                                    props.token && <div className='collection'>\r\n                                        <button className={!isCollect?'collect-bt':'cancel-collect'} \r\n                                            onClick={handCollection}\r\n                                        >{isCollect?'取消收藏':'收藏'}</button></div>    \r\n                                }\r\n                            </div>\r\n\r\n                        </div>\r\n                        <div className='main' dangerouslySetInnerHTML={{ __html: data?.content }}></div>\r\n                        <div className='replies'>\r\n                            <div className=\"col_fade\">{data?.reply_count}条回复</div>\r\n                            {\r\n                                reply?.map((v, i) => {\r\n                                    return (\r\n                                        <div className='cell' key={i}>\r\n                                            <div className=\" author_content\">\r\n                                                <div className=\"reply-are\">\r\n                                                    <NavLink to={'/user/' + v?.author.loginname}>\r\n                                                        <img src={v.author.avatar_url} alt={v.author.loginname} title={v.author.loginname}></img>\r\n                                                    </NavLink>\r\n                                                    <div className=\"use-info\">\r\n                                                        <NavLink to={'/user/' + v?.author.loginname}>{v?.author.loginname}</NavLink>\r\n                                                        <NavLink className='reply_time' onClick={handClick} to={`#${v.id}`}>\r\n                                                            第{i + 1}楼•{timeInterval(v.create_at)}\r\n                                                        </NavLink>\r\n                                                    </div>\r\n\r\n                                                </div>\r\n                                                {\r\n                                                    props.token?(  \r\n                                                        <div className='reply-like' >\r\n                                                            <span onClick={props.token ? likeClcik.bind(this, v.id) : \"\"}>\r\n                                                                🤞{v.ups.length}\r\n                                                            </span>\r\n                                                            {/* <span onClick={props.token ? replyContent.bind(this, v) : \"\"}>\r\n\r\n                                                            </span> */}\r\n                                                        </div>\r\n                                                    ):(\r\n                                                        <div className='reply-like' style={{ 'display': v.ups.length > 0 ? 'block' : 'none' }}>\r\n                                                            <span onClick={props.token ? likeClcik.bind(this, v.id) : null}>\r\n                                                                🤞{v.ups.length}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                    )\r\n                                                }\r\n                                                \r\n                                \r\n                                            </div>\r\n                                            <div className='reply-content' dangerouslySetInnerHTML={{ __html: v.content }}></div>\r\n                                        </div>\r\n                                    )\r\n                                })\r\n                            }\r\n                        </div>\r\n                        {\r\n                            props.token && (\r\n                                <>\r\n                                    <p className='tip'>添加回复</p>\r\n                                    <div className=\"markdown_in_editor\">\r\n                                        <BraftEditor\r\n                                            value={editorState}\r\n                                            controls={controls}\r\n                                            extendControls={extendControls}\r\n                                            onChange={handleEditorChange}\r\n                                        />\r\n                                        <div className=\"prew\" ref={prew}></div>\r\n                                        <div className=\"reply-btn\" onClick={handleReplay}>\r\n                                            <button>回复</button>\r\n                                        </div>\r\n                                    </div>\r\n                                </>\r\n                            )\r\n                        }\r\n                    </div>\r\n                    {data&&<Personal author={data.author}></Personal>}\r\n            </div>\r\n           \r\n            }\r\n        </>\r\n\r\n    )\r\n};\r\nconst mapState = (state) => {\r\n    return {\r\n        token: state?.token\r\n    }\r\n};\r\n// const mapDispatch = dispatch => {\r\n//     return {\r\n//         handClick\r\n//     }\r\n// };\r\nexport default connect(mapState)(Details);","import React,{ useContext } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport {NavLink} from 'react-router-dom';\r\nimport './personal.scss'\r\nexport default function Personal(props) {\r\n    const {token,personal} = useSelector(state=>state);\r\n    if(props.author){\r\n        return <>\r\n            <div className='personal'>\r\n                <p style={{background: '#f6f6f6'}}>作者</p>\r\n                <div className=\"user-personal\">\r\n                    <div className=\"user-big-avatar\">\r\n                        <NavLink to={`/user/${props.author.loginname}`}>\r\n                            <img src={props.author.avatar_url} alt=\"\" title={props.author.loginname} alt={props.author.loginname}/>\r\n                        </NavLink>\r\n                        <NavLink to={`/user/${props.author.loginname}`}>\r\n                            <p>{props.author.loginname}</p>\r\n                        </NavLink>\r\n                    \r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </>\r\n    }\r\n    if(token != ''){\r\n        return (\r\n                <div className='personal'>\r\n                    <p style={{background: '#f6f6f6'}}>个人信息</p>\r\n                    <div className=\"user-personal\">\r\n                        <div className=\"user-big-avatar\">\r\n                            <NavLink to={`/user/${personal.loginname}`}>\r\n                                <img src={personal.avatar_url} alt=\"\" title={personal.loginname} alt={personal.loginname}/>\r\n                            </NavLink>\r\n                            <NavLink to={`/user/${personal.loginname}`}>\r\n                                <p>{personal.loginname}</p>\r\n                            </NavLink>\r\n                           \r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )\r\n    }else{\r\n        return  <div className='personal-no'>\r\n            <p>\r\n                CNode：Node.js专业中文社区\r\n            </p>\r\n           <p className='tourist'>\r\n               当前是游客状态，您可以 <a href='#/login'>登录</a>\r\n           </p>\r\n            \r\n        </div>\r\n    }\r\n   \r\n};\r\n","import React from 'react';\r\nexport default function TopicTab(props) {\r\n    const green ={\r\n        backgroundColor:'#80bd01',\r\n        color: \"#fff\"\r\n    }\r\n    const white ={\r\n        color: '#999',\r\n        backgroundColor: '#e5e5e5',\r\n    }\r\n    const styleGood = {\r\n        color:'#fff',\r\n        fontSize: '12px',\r\n        padding: '2px 4px',\r\n        whiteSpace: 'nowrap',\r\n        lineHeight: 1.5,\r\n        margin: '0 5px',\r\n        borderRadius: 5,\r\n    }\r\n\r\n    if(props.top){\r\n        return <span style={{...styleGood,...green}}>置顶</span>\r\n    }\r\n    if(props.good && !props.top){\r\n        return <span style={{...styleGood,...green}}>精华</span>\r\n    }\r\n    return  <span style={{...styleGood,...white}}>{props.tab=='ask'?'问答':'分享'}</span>\r\n};\r\n"],"sourceRoot":""}